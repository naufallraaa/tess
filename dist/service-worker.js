const CACHE_VERSION="payconnect-v1",filesToCache=["/","/index.html","/assets/images/custom-favicon.png","/manifest.json","/scripts/main.js","/styles/base.css","/styles/buttons.css","/styles/forms.css","/styles/header.css","/styles/footer.css","/styles/home.css","/styles/story-item.css","/styles/story-detail.css","/styles/new-story.css","/styles/maps.css","/styles/auth.css","/styles/bookmark.css","/styles/loader.css","/styles/welcome.css","/styles/responsive.css","/styles/transitions.css","/assets/images/placeholder-image.jpg","/assets/images/icons/icon-72x72.png","/assets/images/icons/icon-96x96.png","/assets/images/icons/icon-128x128.png","/assets/images/icons/icon-144x144.png","/assets/images/icons/icon-152x152.png","/assets/images/icons/icon-192x192.png","/assets/images/icons/icon-384x384.png","/assets/images/icons/icon-512x512.png","https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"];self.addEventListener("install",(s=>{s.waitUntil(caches.open(CACHE_VERSION).then((s=>(console.log("Cache berhasil dibuka dan diisi"),s.addAll(filesToCache)))))})),self.addEventListener("activate",(s=>{s.waitUntil(caches.keys().then((s=>Promise.all(s.filter((s=>s!==CACHE_VERSION)).map((s=>caches.delete(s)))))))})),self.addEventListener("fetch",(s=>{new URL(s.request.url).origin===location.origin?s.respondWith(caches.match(s.request).then((e=>{const t=fetch(s.request).then((e=>{if(e&&200===e.status){const t=e.clone();caches.open(CACHE_VERSION).then((e=>{e.put(s.request,t)}))}return e})).catch((()=>"navigate"===s.request.mode?caches.match("/offline.html"):null));return e||t}))):s.respondWith(fetch(s.request).then((s=>s)).catch((()=>caches.match(s.request))))})),self.addEventListener("push",(s=>{let e={title:"Notifikasi Baru",options:{body:"Ada cerita baru di StoryConnect!",icon:"/assets/images/icons/icon-192x192.png",badge:"/assets/images/icons/icon-72x72.png"}};if(s.data)try{const t=s.data.json();e={title:t.title||e.title,options:{...e.options,body:t.message||e.options.body,data:{url:t.url||"/"}}}}catch(s){console.error("Gagal memproses data notifikasi:",s)}s.waitUntil(self.registration.showNotification(e.title,e.options))})),self.addEventListener("notificationclick",(s=>{s.notification.close();const e=s.notification.data?.url||"/";s.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((s=>{s.some((s=>s.url===e&&(s.focus(),!0)))||clients.openWindow(e).catch((s=>{console.error("Gagal membuka jendela:",s)}))})))}));